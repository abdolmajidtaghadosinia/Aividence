# Aividence

یک دستیار هوشمند برای مدیریت و پردازش فایل‌های صوتی/متنی است که با تکیه بر Django، Celery و رابط کاربری React (Vite) تجربه‌ای یکپارچه از بارگذاری تا ترنسکرایب، بازبینی و خروجی‌گرفتن را فراهم می‌کند.

## قابلیت‌های کلیدی
- **بارگذاری و صف پردازش**: فایل‌ها به‌صورت غیرهمزمان در صف Celery قرار می‌گیرند و وضعیت آن‌ها (در صف، در حال پردازش، تکمیل‌شده، رد شده) به‌روزرسانی می‌شود.
- **نمایش پیشرفت لحظه‌ای و نوتیفیکیشن**: نوارهای پیشرفت متحرک درصد دقیق پردازش را نشان می‌دهند و تغییر وضعیت (شروع، در حال پردازش، اتمام یا رد) با نوتیفیکیشن مرورگر اعلام می‌شود.
- **ترنسکرایب و خلاصه‌سازی**: پس از تکمیل تبدیل/ترنسکرایب، متن استخراج‌شده ذخیره می‌شود و در صورت در دسترس بودن، پردازش زبانی تکمیلی انجام می‌شود.
- **بازبینی و ویرایش**: متن ترنسکرایب‌شده در گام بازبینی به‌صورت پیش‌بارگذاری نمایش داده می‌شود تا کاربر بدون رفرش صفحه ویرایش کند.
- **داشبورد و جست‌وجو**: داشبورد با منوی چسبنده سمت راست، جست‌وجوی فعال در سربرگ (بالای جدول فایل‌ها) و فیلتر لحظه‌ای بر اساس نام فایل‌های پردازش‌شده.
- **خروجی و دانلود**: امکان دریافت فایل‌های Word/PDF/Zip با فونت فارسی و صفحه‌بندی A4؛ نام‌گذاری خروجی بر اساس عنوان فایل صوتی انجام می‌شود تا نسخه‌ها خالی نباشند.
- **واژه‌نامه**: صفحه مدیریت واژه‌های کلیدی برای کمک به دقت ترنسکرایب.

## معماری فنی
- **Frontend**: React 19 + TypeScript با Vite، استایل شیشه‌ای و کامپوننت‌های سفارشی برای نوار پیشرفت، نوتیفیکیشن‌ها و منوی چسبنده.
- **Backend**: Django + Django REST Framework، مدیریت کاربران و فایل‌ها، وبهوک/پولینگ وضعیت، و APIهای کمکی.
- **Task Queue**: Celery با Redis به‌عنوان broker/result backend برای پردازش پس‌زمینه و ردیابی وضعیت.
- **دیتابیس**: PostgreSQL برای ذخیره فایل‌ها، متن پردازش‌شده، و متادیتا.
- **وب سرور**: Nginx به‌همراه Gunicorn در استقرار کانتینری.

## پیش‌نیازها
- Docker و Docker Compose (برای استقرار/اجرای سریع).
- یا برای توسعه محلی بدون Docker:
  - Python 3.12
  - Node.js 20 و npm
  - PostgreSQL و Redis در دسترس

## آماده‌سازی متغیرهای محیطی
نمونه‌ای از مقادیر مورد نیاز در `core/secrets.env` قرار دارد. برای توسعه یا استقرار محلی:
1. یک کپی به نام `core/secrets.local.env` بسازید.
2. مقادیر حساس را با کلیدهای امن خود جایگزین کنید (کلید جنگو، کلید API ترنسکرایب، کلید Gemini و ...).
3. این فایل در `.gitignore` قرار دارد و نباید در مخزن عمومی تعهد شود.

### دسترسی نوتیفیکیشن مرورگر
برای دریافت هشدار وضعیت پردازش:
1. مرورگر را باز کنید و وارد برنامه شوید.
2. درخواست مجوز نوتیفیکیشن را تایید کنید؛ وضعیت‌ها تنها در صورت اجازه‌ی کاربر ارسال می‌شوند.
3. در صورت تغییر حالت پردازش، اعلان فوری ارسال می‌شود و نوار پیشرفت به‌روز می‌گردد.

## اجرای سریع با Docker Compose
```bash
# اجرا با کانفیگ محلی و هلس‌چک (پیشنهادی)
docker-compose -f docker-compose.local.yml up --build
# یا به‌صورت پس‌زمینه
docker-compose -f docker-compose.local.yml up --build -d
```
سرویس‌ها پس از بالا آمدن:
- Frontend: http://localhost:3000
- Backend API و Swagger: http://localhost:8000
- Django Admin: http://localhost:8000/admin/
- Nginx (تجمیع سرویس‌ها): http://localhost

در صورت مشکل هلس‌چک، می‌توانید از `docker-compose.simple.yml` استفاده کنید.

## راه‌اندازی برای توسعه بدون Docker
### Backend (Django)
```bash
cd core
python -m venv .venv
source .venv/bin/activate
pip install -r requirements-py312.txt
export $(cat secrets.local.env | xargs)  # یا بارگذاری دستی مقادیر لازم
python manage.py migrate
python manage.py runserver 0.0.0.0:8000
```
اجرای Celery (در ترمینال جدا):
```bash
cd core
source .venv/bin/activate
export $(cat secrets.local.env | xargs)
python manage_celery.py worker -l info
python manage_celery.py beat -l info  # در صورت نیاز به زمان‌بندی
```

### Frontend (React + Vite)
```bash
cd front
npm install
npm run dev -- --host --port 3000
```
پیش‌فرض API در همان میزبان لوکال است؛ در صورت نیاز آدرس را در لایه فراخوانی API به‌روزرسانی کنید.

> نکته: ورودی جست‌وجوی داشبورد در هدر قرار دارد و به‌صورت زنده جدول فایل‌های پردازش‌شده را فیلتر می‌کند.

## ساخت و تست
- ساخت فرانت‌اند: `cd front && npm run build`
- تست‌های بک‌اند (در صورت تعریف): `cd core && python manage.py test`
- می‌توانید با `docker-compose -f docker-compose.local.yml logs -f` لاگ تمام سرویس‌ها را مشاهده کنید.

## ساختار مخزن
- `core/` : کد Django، تنظیمات، اسکریپت Celery، و فایل‌های Docker مرتبط با بک‌اند.
- `front/` : کد React/Vite، کامپوننت‌ها، صفحات، و استایل‌های فرانت‌اند.
- `docker-compose*.yml` : سناریوهای اجرای کانتینری (محلی یا ساده).
- `README_LOCAL.md` : راهنمای مختصر اجرای محلی با Docker به زبان فارسی.

## نکات عملیاتی
- برای کلیدها و رمزها از متغیرهای محیطی استفاده کنید و فایل‌های حاوی اسرار را متعهد نکنید.
- هنگام استقرار تولیدی، `DJANGO_DEBUG` را روی 0 و `ALLOWED_HOSTS`/`CORS_ALLOWED_ORIGINS` را مطابق دامنه تنظیم کنید.
- اطمینان حاصل کنید Redis و PostgreSQL قبل از اجرای Celery و Django در دسترس باشند.

## پشتیبانی و مشارکت
Pull Requestها و Issueها خوش‌آمدید. لطفاً پیش از ارسال، تغییرات خود را با `npm run build` برای فرانت و تست‌های جنگو برای بک‌اند بررسی کنید.
